<script>
  import CodeWindow from './CodeWindow.html'
  export let events
  $: someEvents = events.length > 0
  $: maxSec = someEvents && events[events.length - 1].sec - events[0].sec
  let currentSec = -1
  let currentEvent
  $: {
    if (currentSec == -1) {
      currentEvent = events[events.length - 1]
    } else {
      for (const e of events) {
        if (e.sec > currentSec + events[0].sec) break
        currentEvent = e
      }
    }
  }
  $: sec = currentSec !== -1 ? currentSec : maxSec
</script>
<div class="panel">
  <CodeWindow code="{currentEvent.source}" />
  {#if currentEvent.hintSource}
  <div class="hint">{currentEvent.hintSource.replace(/^!/, '')}</div>
  {/if} {#if someEvents}
  <ion-range
    min="0"
    max="{maxSec}"
    step="1"
    pin="true"
    value="{sec}"
    on:ionChange="{(e) => currentSec = e.detail.value === maxSec ? -1 : e.detail.value}"
  ></ion-range>
  {/if}
</div>
<style>
  .panel {
    position: relative;
  }
  .hint {
    position: absolute;
    right: 10px;
    top: 10px;
    background-color: rgba(255, 245, 0, 0.1);
    border: 1px solid rgb(40, 40, 40);
    border-radius: 10px;
    max-width: 250px;
    padding: 6px 8px;
  }
  ion-range {
    padding: 0;
  }
</style>
